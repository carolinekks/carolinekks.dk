<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <% content_for :title, "Caroline's page :3" %>
  <title>Caroline's page :3</title>
  <meta name="title" content="Caroline's page :3">

  <link rel="preload" href="https://fonts.googleapis.com/css2?family=Quicksand:wght@500&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
  <%= favicon_link_tag 'tab.ico' %>
  <link rel="icon" type="image/x-icon" href="<%= asset_path 'tab.ico' %>">
  <link rel="shortcut icon" type="image/x-icon" href="<%= asset_path 'tab.ico' %>">
  <link rel="apple-touch-icon" href="<%= asset_path 'tab.ico' %>">
  <link rel="icon" type="image/png" href="<%= asset_path 'tab.ico' %>">
  <meta name="msapplication-TileImage" content="<%= asset_path 'tab.ico' %>">
  <meta name="theme-color" content="#ffc1cc">
  <noscript><link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@500&display=swap" rel="stylesheet"></noscript>

  <style>
    html, body {
      height: 100%;
      margin: 0;
      overflow: hidden;
      font-family: 'Quicksand', sans-serif;
      position: relative;
      background-color: lightpink;
      color: black;
      transition: background-color 0.5s ease, color 0.5s ease;
      user-select:none;
    }

    :root {
      --aboutme-border: rgba(0,0,0,0.1);
      --aboutme-header-bg: rgba(0,0,0,0.04);
      --aboutme-header-hover: rgba(0,0,0,0.06);
      --aboutme-header-open: rgba(0,0,0,0.08);
      --aboutme-content-bg: rgba(0,0,0,0.02);
      --aboutme-arrow-color: #ff4c6d;
      --aboutme-scroll-track: rgba(0,0,0,0.1);
      --aboutme-scroll-thumb: #ff4c6d;
      --app-text: black;
      --app-icon-filter: invert(0) hue-rotate(0deg);
    }

    body.dark-mode {
      --aboutme-border: rgba(255,255,255,0.1);
      --aboutme-header-bg: rgba(255,255,255,0.08);
      --aboutme-header-hover: rgba(255,255,255,0.12);
      --aboutme-header-open: rgba(255,255,255,0.15);
      --aboutme-content-bg: rgba(255,255,255,0.03);
      --aboutme-arrow-color: #ffa1b8;
      --aboutme-scroll-track: rgba(255,255,255,0.1);
      --aboutme-scroll-thumb: #ffa1b8;
      --app-text: white;
      --app-icon-filter: invert(1) hue-rotate(180deg);
    }

    .theme-text {
      color: var(--app-text) !important;
      transition: color .3s ease;
    }

    .theme-icon {
      filter: var(--app-icon-filter) !important;
      transition: filter .3s ease;
    }
    
    body.dark-mode {
      background-color: rebeccapurple;
      color: white;
    }

    .about-me {
      background: linear-gradient(135deg, #ffc1cc, #ffd1dc);
      transition: background-color 0.5s ease;
    }

    body.dark-mode .about-me {
      background: linear-gradient(135deg, #2e1a47, #4e3b6b);
    }

    .about-me-btn, .socials-btn, .gallery-btn, .changelog-btn{
      margin-top: -50px;
      margin-left: -700px;
      background: transparent;
      border: none;
      cursor: pointer;
      padding: 0;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      width: 80px;
      height: auto;
      transition: transform 0.2s ease, color 0.3s ease;
    }

    .about-me-btn:hover, .socials-btn:hover, .gallery-btn:hover, .changelog-btn:hover {
      transform: scale(1.1);
    }

    .about-me-btn:active, .socials-btn:active, .gallery-btn:active, .changelog-btn:active {
      transform: scale(0.9);
    }

    .aboutme-icon, .socials-icon, .gallery-icon, .changelog-icon {
      width: 80px;
      height: 80px;
      color: black;
      stroke-width: 2;
      stroke-linecap: round;
      stroke-linejoin: round;
      transition: stroke 0.3s ease;
    }

    .button-text {
      font-size: 1rem;
      color: black;
      margin-top: 5px;
      transition: color 0.3s ease;
    }

    img[class$="-icon"] {
      pointer-events: none;
      user-select: none;
      -webkit-user-drag: none;
      user-drag: none;
      filter: invert(0) hue-rotate(0deg);
      transition: 
        filter 0.5s ease,
        transform 0.3s ease;
    }

    body.dark-mode img[class$="-icon"] {
      filter: invert(1) hue-rotate(180deg);
    }

    body.dark-mode .button-text {
      color: white;
    }

    .socials-btn {
      margin-left: -300px;
      margin-top: -106px;
    }

    .gallery-btn {
      margin-left: 300px;
      margin-top: -106px;
    }

    .changelog-btn {
      margin-left: 720px;
      margin-top: -106px;
    }

    .about-me img,
    .socials img,
    .changelog img {
      -webkit-user-drag: none !important;
      user-drag: none !important;
      -webkit-user-select: none !important;
      user-select: none !important;
      pointer-events: none !important;
    }

    .waves-container {
      position: fixed;
      bottom: -120px;
      left: 0;
      width: 100%;
      height: 1000px;
      overflow: hidden;
      pointer-events: none;
      z-index: 0;
    }

    .wave-wrapper {
      position: absolute;
      bottom: 0;
      width: 200%; 
      height: 1000px;
      display: flex;
      animation-timing-function: linear;
      animation-iteration-count: infinite;
    }

    .wave1 .wave-wrapper {
      animation-name: wave-scroll;
      animation-duration: 12s;
      animation-timing-function: linear;
      animation-iteration-count: infinite;
      z-index: 3;
    }

    .wave2 .wave-wrapper {
      animation-name: wave-scroll-reverse;
      animation-duration: 18s;
      animation-timing-function: linear;
      animation-iteration-count: infinite;
      bottom: 100px;
      z-index: 2;
    }

    .wave3 .wave-wrapper {
      animation-name: wave-scroll;
      animation-duration: 24s;
      animation-timing-function: linear;
      animation-iteration-count: infinite;
      bottom: 20px;
      z-index: 1;
    }

    .wave-wrapper svg {
      flex-shrink: 0;
      width: 50%;
      height: 1000px;
    }

    .wave1 path {
      fill: #ff7f91;
      opacity: 0.5;
    }

    .wave2 path {
      fill: #ffa1b8;
      opacity: 0.35;
    }

    .wave3 path {
      fill: #ff4c6d;
      opacity: 0.4;
    }

    body.dark-mode .wave1 path {
      fill: #6a4a82;
      opacity: 0.6;
    }

    body.dark-mode .wave2 path {
      fill: #8e6aa9;
      opacity: 0.4;
    }

    body.dark-mode .wave3 path {
      fill: #5c3e6a;
      opacity: 0.5;
    }

    @keyframes wave-scroll {
      0% { transform: translateX(0); } /* TRANS ??? LATEX ??? MMMFGH.., */
      100% { transform: translateX(-50%); }
    }
    @keyframes wave-scroll-reverse {
      0% { transform: translateX(-50%); }
      100% { transform: translateX(0); }
    }
    @keyframes pop-in {
      0% {
        transform: scale(0);
        opacity: 0;
      }
      50% {
        transform: scale(1.1);
        opacity: 1;
      }
      100% {
        transform: scale(1);
        opacity: 1;
      }
    }
    @keyframes pop-out {
      0% {
        transform: scale(1);
        opacity: 1;
      }
      50% {
        transform: scale(1.1);
        opacity: 1;
      }
      100% {
        transform: scale(0);
        opacity: 0;
      }
    }

    #sparkle-container {
      width: 2000px;
      height: 300px;
      position: fixed;
      pointer-events: none;
      z-index: 10;
      transform: translateY(300px)
    }
    .sparkle {
      position: absolute;
      border-radius: 50%;
      background: white;
      opacity: 0.7;
      animation: sparkleAnim 2s infinite alternate;
    }

    @keyframes sparkleAnim {
      0% { opacity: 0.7; }
      100% { opacity: 0; }
    }
    
    body {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      position: relative;
      height: 100vh;
      min-height: 100vh;
    }

    .window, .about-me {
      position: absolute;
      width: 1000px;
      height: 600px;
      visibility: hidden;
      min-height: 400px;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
      background: linear-gradient(135deg, #ffc1cc, #ffd1dc);
      transition: background-color 0.5s ease;
      display: flex;
      flex-direction: column;
      z-index: 10;
      animation: pop-in 0.5s ease-out forwards;
      transform: scale(0);
      opacity: 0;
    }

    .window-title {
      cursor: grab;
      background-color: rgb(88, 83, 86);
      color: white;
      padding: 10px 16px;
      font-weight: bold;
      font-size: 1.2rem;
      user-select: none;
    }

    .window-body {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      height: 100%;
      padding: 20px;
      font-size: 1.3rem;
      color: black;
      background-color: transparent;
      transition: background-color 0.5s ease, color 0.5s ease;
      overflow-y: auto;
    }

    .body-content {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      height: 100%;
      padding: 20px;
      margin-top: -125px;
    }

    .main-text {
      font-size: 3rem;
      font-weight: bold;
      margin-bottom: 10px;
    }

    .sub-text {
      font-size: 1.4rem;
      opacity: 0.85;
    }

    body.dark-mode .window,
    body.dark-mode .about-me {
      background: linear-gradient(135deg, #2e1a47, #4e3b6b);
    }

    body.dark-mode .window-body {
      color: white;
      background-color: transparent;
    }

    body.dark-mode .window-title {
      background-color: rgb(88, 83, 86);
    }

    button.toggle-btn {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: transparent;
      border: none;
      border-radius: 10px;
      padding: 12px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: none;
      transform: scale(1);
      transition: background-color 0.3s ease, color 0.3s ease, transform 0.2s ease;
      outline: none;
      font-size: 1rem;
      color: black;
      z-index: 999;
      width: 60px;
      height: 60px;
    }

    button.toggle-btn:hover {
      transform: scale(1.1);
    }

    button.toggle-btn:focus:not(:hover) {
      transform: scale(1);
    }

    button.toggle-btn.shrink {
      transform: scale(0.8) !important;
      transition: transform 0.1s ease !important;
    }

    body.dark-mode button.toggle-btn {
      color: white;
    }

    svg {
      width: 48px;
      height: 48px;
      stroke-width: 2;
      stroke-linecap: round;
      stroke-linejoin: round;
      transition: all 0.5s ease;
      display: block;
    }

    .sun {
      fill: black;
      stroke: black;
      transition: opacity 0.5s ease, transform 0.5s ease;
    }

    body.dark-mode .sun {
      opacity: 0;
      transform: scale(0.5);
    }

    .sun-rays {
      stroke: black;
      transition: opacity 0.5s ease;
    }

    body.dark-mode .sun-rays {
      opacity: 0;
    }

    .moon {
      fill: black;
      stroke: black;
      opacity: 0;
      transform: translateX(-8px);
      transition: opacity 0.5s ease, transform 0.5s ease;
      mask: url(#moon-mask);
    }

    body.dark-mode .moon {
      opacity: 1;
      transform: translateX(0);
    }

    .window, .about-me {
        will-change: transform;
        contain: layout style paint;
    }

    .waves-container {
        transform: translateZ(0);
        backface-visibility: hidden;
        perspective: 1000;
    }

    .sparkle {
      will-change: transform, opacity;
      transform: translate3d(0, 0, 0);
    }

    @media (prefers-reduced-motion: reduce) {
        * {
            animation-duration: 0.01ms !important;
            animation-iteration-count: 1 !important;
            transition-duration: 0.01ms !important;
        }
        
        .wave-wrapper {
            animation: none !important;
        }
    }
    
    .gallery-main-view img[src*="folder.svg"] {
        pointer-events: none;
        user-select: none;
        -webkit-user-drag: none;
        user-drag: none;
        filter: invert(0) hue-rotate(0deg);
        transition: filter 0.3s ease;
    }

    .folder-content-view img,
    .enlarged-view img {
        -webkit-user-drag: none !important;
        user-drag: none !important;
        -webkit-user-select: none !important;
        user-select: none !important;
        -webkit-touch-callout: none !important;
        pointer-events: auto !important;
    }

    .enlarged-view img[draggable="false"] {
        pointer-events: auto !important;
    }

    .folder-content-view {
        position: relative;
        width: 100%;
        height: 100%;
    }

    .enlarged-view {
        background: inherit !important;
        z-index: 20 !important;
    }

    .folder-content-view > *:not(.enlarged-view) {
        transition: opacity 0.3s ease, transform 0.3s ease;
    }

    .enlarged-view {
        transition: opacity 0.3s ease, transform 0.3s ease !important;
    }

    body.dark-mode .gallery-main-view img[src*="folder.svg"] {
        filter: invert(1) hue-rotate(180deg);
    }

    .folder-text,
    .back-button,
    .folder-caption,
    .folder-alt {
      color: var(--app-text) !important;
      transition: color .3s ease;
    }

    .folder-img {
      filter: var(--app-icon-filter) !important;
      transition: filter .3s ease;
    }

    .changelog-title,
    .changelog-content {
      color: var(--app-text) !important;
      transition: color .3s ease;
    }

    .window.changelog .window-body {
        overflow-x: hidden !important;
        width: 100% !important;
        box-sizing: border-box !important;
    }

    .window.changelog .window-body > div:only-child {
        width: 100% !important;
        text-align: center !important;
        padding: 20px !important;
        box-sizing: border-box !important;
        word-wrap: break-word !important;
        overflow-wrap: break-word !important;
    }

    .window.changelog .window-body:has(> div:only-child) {
        display: flex !important;
        justify-content: center !important;
        align-items: center !important;
    }

    .gallery .close-button {
      color: white !important;
      filter: none !important;
    }
    body.dark-mode .gallery .close-button {
      color: white !important;
      filter: none !important;
    }

    .folder-content-view .image-grid {
        display: grid !important;
        grid-template-columns: repeat(5, 1fr) !important;
        grid-template-rows: repeat(auto-fill, 100px) !important;
        gap: 15px !important;
        width: 100% !important;
        max-width: 900px !important;
        margin: 0 auto !important;
        padding: 20px !important;
        height: 450px !important;
        max-height: 450px !important;
        overflow-y: auto !important;
        overflow-x: hidden !important;
        scrollbar-width: auto !important;
        scrollbar-color: var(--aboutme-scroll-thumb) var(--aboutme-scroll-track) !important;
    }

    .folder-content-view .image-grid::-webkit-scrollbar {
        width: 14px !important;
    }

    .folder-content-view .image-grid::-webkit-scrollbar-track {
        background: var(--aboutme-scroll-track) !important;
        border-radius: 8px !important;
        margin: 4px !important;
    }

    .folder-content-view .image-grid::-webkit-scrollbar-thumb {
        background: var(--aboutme-scroll-thumb) !important;
        border-radius: 8px !important;
        border: 3px solid transparent !important;
        background-clip: content-box !important;
    }

    .folder-content-view .image-grid::-webkit-scrollbar-thumb:hover {
        background: var(--aboutme-arrow-color) !important;
    }

    .folder-content-view .image-grid::-webkit-scrollbar-corner {
        background: transparent !important;
    }

    .folder-content-view .image-grid > div {
        height: 100px !important;
        width: 100% !important;
        border-radius: 8px;
        overflow: hidden;
        cursor: pointer;
        transition: transform 0.3s ease;
        background: var(--aboutme-content-bg);
        cursor: zoom-in !important;
    }
    
    .folder-content-view .image-grid img {
        width: 100% !important;
        height: 100% !important;
        object-fit: cover !important;
        display: block !important;
        transition: transform 0.3s ease;
        cursor: zoom-in !important;
    }

  </style>
</head>
<body>
  <div id="sparkle-container"></div>
  <div class="waves-container" aria-hidden="true">
    <div class="wave1">
      <div class="wave-wrapper">
        <svg viewBox="0 0 600 150" preserveAspectRatio="none">
          <path d="M0 60 C150 90, 300 30, 450 60 C600 90, 600 60, 600 60 L600 150 L0 150 Z" />
        </svg>
        <svg viewBox="0 0 600 150" preserveAspectRatio="none">
          <path d="M0 60 C150 90, 300 30, 450 60 C600 90, 600 60, 600 60 L600 150 L0 150 Z" />
        </svg>
      </div>
    </div>

    <div class="wave2">
      <div class="wave-wrapper">
        <svg viewBox="0 0 600 150" preserveAspectRatio="none">
          <path d="M0 80 C150 110, 300 50, 450 80 C600 110, 600 80, 600 80 L600 150 L0 150 Z" />
        </svg>
        <svg viewBox="0 0 600 150" preserveAspectRatio="none">
          <path d="M0 80 C150 110, 300 50, 450 80 C600 110, 600 80, 600 80 L600 150 L0 150 Z" />
        </svg>
      </div>
    </div>

    <div class="wave3">
      <div class="wave-wrapper">
        <svg viewBox="0 0 600 150" preserveAspectRatio="none">
          <path d="M0 70 C150 100, 300 40, 450 70 C600 100, 600 70, 600 70 L600 150 L0 150 Z" />
        </svg>
        <svg viewBox="0 0 600 150" preserveAspectRatio="none">
          <path d="M0 70 C150 100, 300 40, 450 70 C600 100, 600 70, 600 70 L600 150 L0 150 Z" />
        </svg>
      </div>
    </div>
  </div>

  <div class="window" id="draggable-window">
    <div class="window-title" id="titlebar">Caroline's page :3</div>
    <div class="window-body">
      <div class="body-content">
        <div class="main-text">Hello I'm Caroline! ^œâ^</div>
        <div class="sub-text">girlfailure, puppy, and professional idiot</div>
        <div class="sub-text">(im baller beyond belief)</div>
      </div>
      <button class="about-me-btn" aria-label="About me">
        <%= image_tag "aboutme.svg", class: "aboutme-icon" %>
        <span class="button-text">About me</span>
      </button>
      <button class="socials-btn" aria-label="socials">
        <%= image_tag "socials.svg", class: "socials-icon" %>
        <span class="button-text">Socials</span>
      </button>
      <button class="gallery-btn" aria-label="gallery">
        <%= image_tag "gallery.svg", class: "gallery-icon" %>
        <span class="button-text">Gallery</span>
      </button>
      <button class="changelog-btn" aria-label="changelog">
        <%= image_tag "changelog.svg", class: "changelog-icon" %>
        <span class="button-text">Changelog</span>
      </button>
      </div>
    </div>
  </div>

  <button class="toggle-btn" aria-label="Toggle Color Mode">
    <svg viewBox="0 0 24 24">
      <defs>
        <mask id="moon-mask">
          <rect width="100%" height="100%" fill="white" />
          <circle cx="9" cy="12" r="5" fill="black" />
        </mask>
      </defs>
      <circle class="sun" cx="12" cy="12" r="5" />
      <g class="sun-rays">
        <line x1="12" y1="1" x2="12" y2="3" />
        <line x1="12" y1="21" x2="12" y2="23" />
        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64" />
        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78" />
        <line x1="1" y1="12" x2="3" y2="12" />
        <line x1="21" y1="12" x2="23" y2="12" />
        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36" />
        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22" />
      </g>
      <circle class="moon" cx="12" cy="12" r="5" />
    </svg>
  </button>

  <audio id="light-sound" src="<%= asset_path 'light.ogg' %>" preload="auto"></audio>
  <audio id="dark-sound" src="<%= asset_path 'dark.ogg' %>" preload="auto"></audio>
  <audio id="button-click-sound" src="<%= asset_path 'click.ogg' %>" preload="auto"></audio>
  <audio id="close-sound" src="<%= asset_path 'close.ogg' %>" preload="auto"></audio>
  <audio id="folder-sound" src="<%= asset_path 'folder.ogg' %>" preload="auto"></audio>
  <meta http-equiv="Cache-Control" content="public, max-age=3600">

  <script>
    function centerWindow() {
      const windowBox = document.getElementById("draggable-window");
      const width = windowBox.offsetWidth;
      const height = windowBox.offsetHeight;
      const x = (window.innerWidth - width) / 2;
      const y = (window.innerHeight - height) / 2;
      windowBox.style.left = `${x}px`;
      windowBox.style.top = `${y}px`;
      windowBox.style.visibility = "visible";
    }
    window.addEventListener("load", centerWindow);
    window.addEventListener("resize", centerWindow);

    const toggleBtn = document.querySelector('button.toggle-btn');
    const lightSound = document.getElementById("light-sound");
    const darkSound = document.getElementById("dark-sound");
    const buttonClickSound = document.getElementById("button-click-sound");
    const folderSound = document.getElementById("folder-sound")
    const closeSound = document.getElementById('close-sound');

    toggleBtn.addEventListener('click', () => {
      if (document.body.classList.contains('dark-mode')) {
        lightSound.volume = 0.3;
        lightSound.currentTime = 0;
        lightSound.play();
      } else {
        darkSound.volume = 0.3;
        darkSound.currentTime = 0;
        darkSound.play();
      }

      document.body.classList.toggle('dark-mode');
    });

    function addShrink() {
      toggleBtn.classList.add('shrink');
    }

    function removeShrink() {
      toggleBtn.classList.remove('shrink');
    }

    toggleBtn.addEventListener('mousedown', addShrink);
    toggleBtn.addEventListener('mouseup', removeShrink);
    toggleBtn.addEventListener('mouseleave', removeShrink);

    toggleBtn.addEventListener('touchstart', (e) => {
      e.preventDefault();
      addShrink();
    });
    toggleBtn.addEventListener('touchend', (e) => {
      e.preventDefault();
      removeShrink();
    });
    toggleBtn.addEventListener('touchcancel', (e) => {
      e.preventDefault();
      removeShrink();
    });

    const windowBox = document.getElementById("draggable-window");
    const titleBar = document.getElementById("titlebar");

    /* no clue why this specifically is why the home tab is movable */
    function clampWindowPosition(x, y, box) {
      const minX = 0;
      const minY = 0;
      const maxX = window.innerWidth - box.offsetWidth;
      const maxY = 1.485*box.offsetHeight;
      const clampedX = Math.min(Math.max(x, minX), maxX);
      const clampedY = Math.min(Math.max(y, minY), maxY);
      return { x: clampedX, y: clampedY };
    }

    let isDragging = false;
    let offsetX = 0;
    let offsetY = 0;

    titleBar.addEventListener("mousedown", (e) => {
      isDragging = true;
      offsetX = e.clientX - windowBox.offsetLeft;
      offsetY = e.clientY - windowBox.offsetTop;
      windowBox.style.transition = "none";
      windowBox.style.transform = "";
    });

    document.addEventListener("mousemove", (e) => {
      if (isDragging) {
        let newX = e.clientX - offsetX;
        let newY = e.clientY - offsetY;
        const pos = clampWindowPosition(newX, newY, windowBox);
        windowBox.style.left = pos.x + "px";
        windowBox.style.top = pos.y + "px";
        windowBox.style.transform = "";
      }
    });

    document.addEventListener("mouseup", () => {
      isDragging = false;
      windowBox.style.transition = "";
    });

    window.addEventListener("resize", () => {
      const currentLeft = windowBox.offsetLeft;
      const currentTop = windowBox.offsetTop;
      const clampedPos = clampWindowPosition(currentLeft, currentTop, windowBox);
      windowBox.style.left = clampedPos.x + "px";
      windowBox.style.top = clampedPos.y + "px";
    });

    document.addEventListener('DOMContentLoaded', () => {
      const aboutmeBtn = document.querySelector('.about-me-btn');
      const socialsBtn = document.querySelector('.socials-btn');
      const galleryBtn = document.querySelector('.gallery-btn');
      const changelogBtn = document.querySelector('.changelog-btn');
      let existingBlock = null; 
      let socialsBlock = null;
      let galleryBlock = null;
      let changelogBlock = null;

      function makeDraggable(windowElement) {
        const titleBar = windowElement.querySelector('.window-title');
        let isDragging = false;
        let offsetX = 0;
        let offsetY = 0;

        titleBar.addEventListener('mousedown', (e) => {
          isDragging = true;
          offsetX = e.clientX - windowElement.offsetLeft;
          offsetY = e.clientY - windowElement.offsetTop;
          windowElement.style.transition = "none";
          windowElement.style.transform = "";
        });

        document.addEventListener('mousemove', (e) => {
          if (isDragging) {
            let newX = e.clientX - offsetX;
            let newY = e.clientY - offsetY;

            const minX = 0;
            const minY = 0;
            const maxX = window.innerWidth - windowElement.offsetWidth;
            const maxY = 1.485*windowElement.offsetHeight;
            const clampedX = Math.min(Math.max(newX, minX), maxX);
            const clampedY = Math.min(Math.max(newY, minY), maxY);

            windowElement.style.left = `${clampedX}px`;
            windowElement.style.top = `${clampedY}px`;
          }
        });

        document.addEventListener('mouseup', () => {
          isDragging = false;
          windowElement.style.transition = "";
        });
      }

      function positionWindowRandomly(el, width = 800, height = 500) {
        el.style.position = "absolute";
        const maxX = Math.max(0, window.innerWidth - width);
        const maxY = Math.max(0, window.innerHeight - height);
        const randomLeft = Math.floor(Math.random() * maxX);
        const randomTop  = Math.floor(Math.random() * maxY);
        el.style.left = randomLeft + "px";
        el.style.top  = randomTop + "px";
      }

      function handleAboutMeClick() {
          buttonClickSound.volume = 0.3;
          buttonClickSound.currentTime = 0;
          buttonClickSound.play();
          if (existingBlock) return;

          const newBlock = document.createElement('div');
          newBlock.className = 'window about-me';
          newBlock.style.cssText = `
              position: absolute; 
              width: 1000px; 
              height: 600px; 
              visibility: visible; 
              border-radius: 10px; 
              box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15); 
              display: flex; 
              flex-direction: column;
              z-index: 10;
              animation: pop-in 0.5s ease-out forwards;
              transform: scale(0);
              opacity: 0;
              overflow: hidden;
          `;

          const titleBar = document.createElement('div');
          titleBar.className = 'window-title';
          titleBar.textContent = 'About me!~';
          titleBar.style.cssText = `
              background-color: rgb(88, 83, 86); 
              color: white; 
              padding: 10px 16px; 
              font-weight: bold; 
              font-size: 1.2rem; 
              cursor: grab; 
              user-select: none;
          `;

          const closeButton = document.createElement('button');
          closeButton.textContent = '‚úñ';
          closeButton.style.cssText = `
              position: absolute;
              top: 10px;
              right: 10px;
              background: transparent;
              border: none;
              color: white;
              border-radius: 5px;
              padding: 5px, 10px;
              cursor: pointer;
              font-size: 1.2rem;
              outline: none;
              transition: transform 0.2s ease, background-color 0.3s ease;
              z-index: 15;
          `;

          closeButton.addEventListener('mouseover', () => {
              closeButton.style.transform = 'scale(1.2)';
          });

          closeButton.addEventListener('mouseout', () => {
              closeButton.style.transform = 'scale(1)';
          });

          closeButton.addEventListener('mousedown', () => {
              closeButton.style.transform = 'scale(0.8)';
          });

          closeButton.addEventListener('mouseup', () => {
              closeButton.style.transform = 'scale(1)';
          });

          closeButton.addEventListener('click', () => {
              closeSound.volume = 0.3;
              closeSound.currentTime = 0;
              closeSound.play();
              newBlock.style.animation = 'pop-out 0.5s ease-out forwards';
              setTimeout(() => {
                  newBlock.remove();
                  existingBlock = null;
              }, 500);
          });

          const bodyContainer = document.createElement('div');
          bodyContainer.style.cssText = `
              flex: 1;
              display: flex;
              padding: 20px;
              height: calc(100% - 60px);
              overflow: hidden;
          `;

          const leftSide = document.createElement('div');
          leftSide.style.cssText = `
              width: 60%;
              padding-right: 20px;
              display: flex;
              flex-direction: column;
              overflow-y: auto;
              height: 100%;
          `;

          const rightSide = document.createElement('div');
          rightSide.style.cssText = `
              width: 40%;
              padding-left: 20px;
              display: flex;
              flex-direction: column;
              align-items: center;
              justify-content: flex-start;
              height: 100%;
          `;

          const aboutMeImage = document.createElement('img');
          aboutMeImage.src = '<%= asset_path "aboutme.webp" %>'; 
          aboutMeImage.setAttribute('draggable', 'false');
          aboutMeImage.style.cssText = `
              width: 200px;
              height: 200px;
              border-radius: 15px;
              object-fit: cover;
              box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
              transition: transform 0.3s ease;
              margin-bottom: 25px;
              margin-top: 20px;
          `;

          const largeText = document.createElement('div');
          largeText.textContent = 'Caroline Weaver';
          largeText.style.cssText = `
              font-size: 2.2rem;
              font-weight: bold;
              color: inherit;
              text-align: center;
              margin-bottom: 10px;
              line-height: 1.2;
          `;

          const smallText = document.createElement('div');
          smallText.textContent = '(Informally known as Callie) she//her üè≥Ô∏è‚Äç‚ößÔ∏è';
          smallText.style.cssText = `
              font-size: 1.5rem;
              color: inherit;
              text-align: center;
              opacity: 0.9;
              margin-bottom: 30px;
              line-height: 1.3;
          `;

          const currentAge=Math.floor((Date.now() - new Date('2008-02-22').getTime()) / (365.25 * 24 * 60 * 60 * 1000));

          /* MORE DROPDOWNS GO HERE */
          const dropdownSections = [
              {
                  title: "Hi! I'm Caroline I...",
                  content: "‚Ä¢ am learning arc welding (TIG)<br>‚Ä¢ play lots different games<br>‚Ä¢ listen to vast genres of music"
              },
              {
                  title: "Who are you?",
                  content: `‚Ä¢ I\'m a furry, pansexual, tgal, from Southern California :3 <br> ‚Ä¢ I am currently ${currentAge}, turning ${currentAge+1} in February`
              },
              {
                  title: "What are some of your interests?",
                  content: `‚Ä¢ Marine biology <br> ‚Ä¢ Combinatorics & Number Theory <br> ‚Ä¢ RPGS & Roguelites <br> ‚Ä¢ Fishing <br> ‚Ä¢ Diving`
              },
              {
                  title: "Fun facts about me!",
                  content: `‚Ä¢ I speak both English and Danish <br> ‚Ä¢ I am an unlabled type of colorblind <br> ‚Ä¢ I am autistic and schizotypal <br> ‚Ä¢ My personality types are INFP-T and 6w5`
              }
          ];

          const aboutMeId = `aboutme-${Date.now()}`;
          newBlock.id = aboutMeId;

          const style = document.createElement('style');
          style.textContent = generateAboutMeStyles(aboutMeId, document.body.classList.contains('dark-mode'));
          newBlock.appendChild(style);

          dropdownSections.forEach((section, index) => {
              const dropdownElement = createAboutMeDropdown(section.title, section.content, aboutMeId);
              leftSide.appendChild(dropdownElement);
          });

          rightSide.appendChild(aboutMeImage);
          rightSide.appendChild(largeText);
          rightSide.appendChild(smallText);

          bodyContainer.appendChild(leftSide);
          bodyContainer.appendChild(rightSide);
          
          newBlock.appendChild(closeButton);
          newBlock.appendChild(titleBar);
          newBlock.appendChild(bodyContainer);
          
          document.body.appendChild(newBlock);
          positionWindowRandomly(newBlock, 1000, 600);
          makeDraggable(newBlock);
          
          existingBlock = newBlock;
      }

      function createAboutMeDropdown(title, content, aboutMeId) {
          const dropdownElement = document.createElement('div');
          dropdownElement.className = 'aboutme-dropdown';

          const header = document.createElement('div');
          header.className = 'aboutme-header';
          header.innerHTML = `
              <span class="aboutme-title">${title}</span>
              <span class="aboutme-arrow">‚ñ∂</span>
          `;

          const contentDiv = document.createElement('div');
          header.querySelector('.aboutme-title').classList.add('theme-text');
          contentDiv.classList.add('theme-text');
          contentDiv.className = 'aboutme-content';
          contentDiv.innerHTML = content;

          header.addEventListener('click', () => {
              buttonClickSound.volume = 0.2;
              buttonClickSound.currentTime = 0;
              buttonClickSound.play();

              document.querySelectorAll(`#${aboutMeId} .aboutme-content.open`).forEach(openContent => {
                  if (openContent !== contentDiv) {
                      openContent.classList.remove('open');
                      openContent.previousElementSibling.classList.remove('open');
                  }
              });

              header.classList.toggle('open');
              contentDiv.classList.toggle('open');
          });

          dropdownElement.appendChild(header);
          dropdownElement.appendChild(contentDiv);

          return dropdownElement;
      }

      function generateAboutMeStyles(aboutMeId) {
          return `
              #${aboutMeId} .aboutme-dropdown {
                  margin-bottom: 15px;
                  border-radius: 8px;
                  overflow: hidden;
                  border: 1px solid var(--aboutme-border);
                  flex-shrink: 0;
              }

              #${aboutMeId} .aboutme-header {
                  display: flex;
                  justify-content: space-between;
                  align-items: center;
                  padding: 15px 20px;
                  background-color: var(--aboutme-header-bg);
                  cursor: pointer;
                  user-select: none;
                  transition: all 0.2s ease;
              }

              #${aboutMeId} .aboutme-header:hover {
                  background-color: var(--aboutme-header-hover);
              }

              #${aboutMeId} .aboutme-header.open {
                  background-color: var(--aboutme-header-open);
              }

              #${aboutMeId} .aboutme-title {
                  font-size: 1.3rem;
                  font-weight: bold;
                  color: inherit;
                  flex: 1;
              }

              #${aboutMeId} .aboutme-arrow {
                  transition: transform 0.3s ease;
                  color: var(--aboutme-arrow-color);
                  font-size: 1.1rem;
                  margin-left: 10px;
              }

              #${aboutMeId} .aboutme-header.open .aboutme-arrow {
                  transform: rotate(90deg);
              }

              #${aboutMeId} .aboutme-content {
                  max-height: 0;
                  overflow: hidden;
                  padding: 0 20px;
                  background-color: var(--aboutme-content-bg);
                  transition: all 0.3s ease;
                  font-size: 1.2rem;
                  line-height: 1.6;
              }

              #${aboutMeId} .aboutme-content.open {
                  max-height: 200px;
                  padding: 15px 20px;
                  overflow-y: auto;
              }

              #${aboutMeId} .aboutme-content::-webkit-scrollbar {
                  width: 6px;
              }

              #${aboutMeId} .aboutme-content::-webkit-scrollbar-track {
                  background: var(--aboutme-scroll-track);
                  border-radius: 3px;
              }

              #${aboutMeId} .aboutme-content::-webkit-scrollbar-thumb {
                  background: var(--aboutme-scroll-thumb);
                  border-radius: 3px;
              }

              #${aboutMeId} .aboutme-content::-webkit-scrollbar-thumb:hover {
                  background: var(--aboutme-scroll-thumb);
              }
          `;
      }

      function handleSocialsClick() {
        buttonClickSound.volume = 0.3;
        buttonClickSound.currentTime = 0;
        buttonClickSound.play();
        if (socialsBlock) return;

        let telegramInfoWindow = null;

        const newBlock = document.createElement('div');
        newBlock.className = 'window socials';
        newBlock.style.cssText = `
          position: absolute; 
          width: 1000px; 
          height: 600px; 
          visibility: visible; 
          border-radius: 10px; 
          box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15); 
          display: flex; 
          flex-direction: column;
          z-index: 10;
          animation: pop-in 0.5s ease-out forwards;
          transform: scale(0);
          opacity: 0;
        `;

        const closeButton = document.createElement('button');
        closeButton.textContent = '‚úñ';
        closeButton.style.cssText = `
          position: absolute;
          top: 10px;
          right: 10px;
          background: transparent;
          border: none;
          color: white;
          border-radius: 5px;
          padding: 5px, 10px;
          cursor: pointer;
          font-size: 1.2rem;
          outline: none;
          transition: transform 0.2s ease, background-color 0.3s ease;
        `;

        closeButton.addEventListener('mouseover', () => {
          closeButton.style.transform = 'scale(1.2)';
          closeButton.style.backgroundColor = 'transparent';
        });

        closeButton.addEventListener('mouseout', () => {
          closeButton.style.transform = 'scale(1)';
          closeButton.style.backgroundColor = 'transparent';
        });

        closeButton.addEventListener('mousedown', () => {
          closeButton.style.transform = 'scale(0.8)';
        });

        closeButton.addEventListener('mouseup', () => {
          closeButton.style.transform = 'scale(1)';
        });


        closeButton.addEventListener('click', () => {
          darkModeObserver.disconnect();
          closeSound.volume = 0.3;
          closeSound.currentTime = 0;
          closeSound.play();
          newBlock.style.animation = 'pop-out 0.5s ease-out forwards';
          setTimeout(() => {
            newBlock.remove();
            socialsBlock = null;
          }, 500);
          newBlock.querySelectorAll('*').forEach(el => {
            el.replaceWith(el.cloneNode(true));
          });
        });

        const titleBar = document.createElement('div');
        titleBar.className = 'window-title';
        titleBar.textContent = 'My Socials!~';
        titleBar.style.cssText = `
          background-color: rgb(88, 83, 86); 
          color: white; 
          padding: 10px 16px; 
          font-weight: bold; 
          font-size: 1.2rem; 
          cursor: grab; 
          user-select: none;
        `;

        const bodyContent = document.createElement('div');
        bodyContent.className = 'window-body';
        bodyContent.style.cssText = `
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          gap: 20px;
          position: relative;
          height: 100%;
        `;

        const steamContainer = document.createElement('div');
        steamContainer.style.cssText = `
            display: flex;
            flex-direction: column;
            align-items: center;
            position: absolute;
            top: 80px;
            left: 20%;
            transform: translateX(-50%);
            z-index: 1;
            gap: 10px;
        `;

        const steamButton = document.createElement('button');
        steamButton.style.cssText = `
          background: transparent;
          border: none;
          cursor: alias;
          padding: 0;
          transition: transform 0.2s ease;
          border-radius: 50%;
          overflow: hidden;
          width: 100px;
          height: 100px;
        `;

        const steamImg = document.createElement('img');
        steamImg.src = '<%= asset_path "steammain.webp" %>';
        steamImg.setAttribute('draggable', 'false');
        steamImg.style.cssText = `
          width: 100%;
          height: 100%;
          object-fit: cover;
          transition: transform 0.3s ease;
        `;

        const steamText = document.createElement('div');
        steamText.textContent = 'Steam';
        steamText.style.cssText = `
            color: ${document.body.classList.contains('dark-mode') ? 'white' : 'black'};
            font-size: 1.2rem;
            transition: color 0.3s ease;
        `;

        const steamContainer2 = document.createElement('div');
        steamContainer2.style.cssText = `
            display: flex;
            flex-direction: column;
            align-items: center;
            position: absolute;
            top: 80px;
            left: 80%;
            transform: translateX(-50%); 
            z-index: 1;
            gap: 10px;
        `;

        const steamButton2 = document.createElement('button');
        steamButton2.style.cssText = `
            background: transparent;
            border: none;
            cursor: alias;
            padding: 0;
            transition: transform 0.2s ease;
            border-radius: 50%;
            overflow: hidden;
            width: 100px;
            height: 100px;
        `;

        const steamImg2 = document.createElement('img');
        steamImg2.src = '<%= asset_path "steam2.webp" %>';
        steamImg2.setAttribute('draggable', 'false');
        steamImg2.style.cssText = `
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        `;

        const steamText2 = document.createElement('div');
        steamText2.textContent = 'Steam (again)';
        steamText2.style.cssText = `
            color: ${document.body.classList.contains('dark-mode') ? 'white' : 'black'};
            font-size: 1.2rem;
            transition: color 0.3s ease;
        `;

        const telegramContainer = document.createElement('div');
        telegramContainer.style.cssText = `
            display: flex;
            flex-direction: column;
            align-items: center;
            position: absolute;
            top: 80px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1;
            gap: 10px;
        `;

        const telegramButton = document.createElement('button');
        telegramButton.style.cssText = `
            background: transparent;
            border: none;
            cursor: alias;
            padding: 0;
            transition: transform 0.2s ease;
            border-radius: 50%;
            overflow: hidden;
            width: 100px;
            height: 100px;
        `;

        const telegramImg = document.createElement('img');
        telegramImg.src = '<%= asset_path "telegram.webp" %>';
        telegramImg.setAttribute('draggable', 'false');
        telegramImg.style.cssText = `
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        `;

        const telegramText = document.createElement('div');
        telegramText.textContent = 'Telegram';
        telegramText.style.cssText = `
            color: ${document.body.classList.contains('dark-mode') ? 'white' : 'black'};
            font-size: 1.2rem;
            transition: color 0.3s ease;
        `;

        const lastfmContainer = document.createElement('div');
        lastfmContainer.style.cssText = `
            display: flex;
            flex-direction: column;
            align-items: center;
            position: absolute;
            top: 270px;
            left: 20%;
            transform: translateX(-50%);
            z-index: 1;
            gap: 10px;
        `;

        const lastfmButton = document.createElement('button');
        lastfmButton.style.cssText = `
            background: transparent;
            border: none;
            cursor: alias;
            padding: 0;
            transition: transform 0.2s ease;
            border-radius: 50%;
            overflow: hidden;
            width: 100px;
            height: 100px;
        `;

        const lastfmImg = document.createElement('img');
        lastfmImg.src = '<%= asset_path "lastfm.webp" %>';
        lastfmImg.setAttribute('draggable', 'false');
        lastfmImg.style.cssText = `
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        `;

        const lastfmText = document.createElement('div');
        lastfmText.textContent = 'Last.fm';
        lastfmText.style.cssText = `
            color: ${document.body.classList.contains('dark-mode') ? 'white' : 'black'};
            font-size: 1.2rem;
            transition: color 0.3s ease;
        `;

        const instagramContainer = document.createElement('div');
        instagramContainer.style.cssText = `
            display: flex;
            flex-direction: column;
            align-items: center;
            position: absolute;
            top: 270px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1;
            gap: 10px;
        `;

        const instagramButton = document.createElement('button');
        instagramButton.style.cssText = `
            background: transparent;
            border: none;
            cursor: alias;
            padding: 0;
            transition: transform 0.2s ease;
            border-radius: 50%;
            overflow: hidden;
            width: 100px;
            height: 100px;
        `;

        const instagramImg = document.createElement('img');
        instagramImg.src = '<%= asset_path "insta.webp" %>';
        instagramImg.setAttribute('draggable', 'false');
        instagramImg.style.cssText = `
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        `;

        const instagramText = document.createElement('div');
        instagramText.textContent = 'Instagram';
        instagramText.style.cssText = `
            color: ${document.body.classList.contains('dark-mode') ? 'white' : 'black'};
            font-size: 1.2rem;
            transition: color 0.3s ease;
        `;

        const githubContainer = document.createElement('div');
        githubContainer.style.cssText = `
            display: flex;
            flex-direction: column;
            align-items: center;
            position: absolute;
            top: 270px;
            left: 80%;
            transform: translateX(-50%);
            z-index: 1;
            gap: 10px;
        `;

        const githubButton = document.createElement('button');
        githubButton.style.cssText = `
            background: transparent;
            border: none;
            cursor: alias;
            padding: 0;
            transition: transform 0.2s ease;
            border-radius: 50%;
            overflow: hidden;
            width: 100px;
            height: 100px;
        `;

        const githubImg = document.createElement('img');
        githubImg.src = '<%= asset_path "github.webp" %>';
        githubImg.setAttribute('draggable', 'false');
        githubImg.style.cssText = `
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        `;

        const githubText = document.createElement('div');
        githubText.textContent = 'GitHub';
        githubText.style.cssText = `
            color: ${document.body.classList.contains('dark-mode') ? 'white' : 'black'};
            font-size: 1.2rem;
            transition: color 0.3s ease;
        `;

        const darkModeObserver = new MutationObserver(() => {
            steamText.style.color = document.body.classList.contains('dark-mode') ? 'white' : 'black';
            steamText2.style.color = document.body.classList.contains('dark-mode') ? 'white' : 'black';
            telegramText.style.color = document.body.classList.contains('dark-mode') ? 'white' : 'black';
            lastfmText.style.color = document.body.classList.contains('dark-mode') ? 'white' : 'black';
            instagramText.style.color = document.body.classList.contains('dark-mode') ? 'white' : 'black';
            githubText.style.color = document.body.classList.contains('dark-mode') ? 'white' : 'black';
        });

        darkModeObserver.observe(document.body, {
            attributes: true,
            attributeFilter: ['class']
        });

        if (document.body.classList.contains('dark-mode')) {
            steamText.style.color = 'white';
            steamText2.style.color = 'white';
            telegramText.style.color = 'white';
            lastfmText.style.color = 'white';
            instagramText.style.color = 'white';
            githubText.style.color = 'white';
        }

        steamButton.appendChild(steamImg);
        steamContainer.appendChild(steamButton);
        steamContainer.appendChild(steamText);

        steamButton2.appendChild(steamImg2);
        steamContainer2.appendChild(steamButton2);
        steamContainer2.appendChild(steamText2);

        telegramButton.appendChild(telegramImg);
        telegramContainer.appendChild(telegramButton);
        telegramContainer.appendChild(telegramText);

        lastfmButton.appendChild(lastfmImg);
        lastfmContainer.appendChild(lastfmButton);
        lastfmContainer.appendChild(lastfmText);

        instagramButton.appendChild(instagramImg);
        instagramContainer.appendChild(instagramButton);
        instagramContainer.appendChild(instagramText);

        githubButton.appendChild(githubImg);
        githubContainer.appendChild(githubButton);
        githubContainer.appendChild(githubText);

        telegramButton.addEventListener('click', () => {
            if (telegramInfoWindow) return;

            buttonClickSound.volume = 0.3;
            buttonClickSound.currentTime = 0;
            buttonClickSound.play();
            
            const telegramWindow = document.createElement('div');
            telegramWindow.className = 'window telegram-info';
            telegramWindow.style.cssText = `
                position: absolute;
                left: ${Math.random() * (window.innerWidth - 1920)}px;
                top: ${Math.random() * (window.innerHeight - 1080)}px;
                width: 700px;
                height: 3px;
                visibility: visible;
                border-radius: 10px;
                box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
                display: flex;
                flex-direction: column;
                z-index: 20;
                animation: pop-in 0.5s ease-out forwards;
                transform: scale(0);
                opacity: 0;
            `;

            telegramInfoWindow = telegramWindow;

            const telegramCloseButton = document.createElement('button');
            telegramCloseButton.textContent = '‚úñ';
            telegramCloseButton.style.cssText = `
                position: absolute;
                top: 10px;
                right: 10px;
                background: transparent;
                border: none;
                color: white;
                border-radius: 5px;
                padding: 5px, 10px;
                cursor: pointer;
                font-size: 1.2rem;
                outline: none;
                transition: transform 0.2s ease, background-color 0.3s ease;
            `;

            telegramCloseButton.addEventListener('click', () => {
              closeSound.volume = 0.3;
              closeSound.currentTime = 0;
              closeSound.play();
              telegramWindow.style.animation = 'pop-out 0.5s ease-out forwards';
              setTimeout(() => {
                  telegramWindow.remove();
                  telegramInfoWindow = null;
              }, 500);
            });

            const telegramTitleBar = document.createElement('div');
            telegramTitleBar.className = 'window-title';
            telegramTitleBar.textContent = 'telegram Info';
            telegramTitleBar.style.cssText = `
                background-color: rgb(88, 83, 86);
                color: white;
                padding: 10px 16px;
                font-weight: bold;
                font-size: 1.2rem;
                cursor: grab;
                user-select: none;
            `;

            const telegramBodyContent = document.createElement('div');
            telegramBodyContent.className = 'window-body';
            telegramBodyContent.style.cssText = `
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                height: 100%;
                padding: 20px;
            `;
            const telegramMainText = document.createElement('div');
            telegramMainText.className = 'main-text';
            telegramMainText.style.fontSize = '1.5rem';
            telegramMainText.textContent = 'my ONLY telegram account is @carolinekks';

            const telegramSubText = document.createElement('div');
            telegramSubText.className = 'sub-text';
            telegramSubText.style.fontSize = '1.3rem';
            telegramSubText.textContent = 'Moved off of discord due to the id implementation';

            telegramBodyContent.appendChild(telegramMainText);
            telegramBodyContent.appendChild(telegramSubText);

            telegramWindow.appendChild(telegramCloseButton);
            telegramWindow.appendChild(telegramTitleBar);
            telegramWindow.appendChild(telegramBodyContent);
            document.body.appendChild(telegramWindow);
            positionWindowRandomly(telegramWindow, 700, 300);
            makeDraggable(telegramWindow);
        });

        steamButton.addEventListener('mouseover', () => {
          steamButton.style.transform = 'scale(1.1)';
          steamImg.style.transform = 'scale(1.05)';
        });

        steamButton.addEventListener('mouseout', () => {
          steamButton.style.transform = 'scale(1)';
          steamImg.style.transform = 'scale(1)';
        });


        steamButton.addEventListener('mousedown', () => {
          steamButton.style.transform = 'scale(1)';
          steamImg.style.transform = 'scale(1)';
        });

        steamButton.addEventListener('click', () => {
          buttonClickSound.volume = 0.3;
          buttonClickSound.currentTime = 0;
          buttonClickSound.play();
          window.open('https://steamcommunity.com/id/carolinekks/', '_blank');
        });

        steamButton2.addEventListener('mouseover', () => {
            steamButton2.style.transform = 'scale(1.1)';
            steamImg2.style.transform = 'scale(1.05)';
        });

        steamButton2.addEventListener('mouseout', () => {
            steamButton2.style.transform = 'scale(1)';
            steamImg2.style.transform = 'scale(1)';
        });

        steamButton2.addEventListener('mousedown', () => {
            steamButton2.style.transform = 'scale(1)';
            steamImg2.style.transform = 'scale(1)';
        });

        steamButton2.addEventListener('click', () => {
            buttonClickSound.volume = 0.3;
            buttonClickSound.currentTime = 0;
            buttonClickSound.play();
            window.open('https://steamcommunity.com/id/puppygirly/', '_blank');
        });

        telegramButton.addEventListener('mouseover', () => {
            telegramButton.style.transform = 'scale(1.1)';
            telegramImg.style.transform = 'scale(1.05)';
        });

        telegramButton.addEventListener('mouseout', () => {
            telegramButton.style.transform = 'scale(1)';
            telegramImg.style.transform = 'scale(1)';
        });

        telegramButton.addEventListener('mousedown', () => {
            telegramButton.style.transform = 'scale(1)';
            telegramImg.style.transform = 'scale(1)';
        });

        lastfmButton.addEventListener('mouseover', () => {
            lastfmButton.style.transform = 'scale(1.1)';
            lastfmImg.style.transform = 'scale(1.05)';
        });

        lastfmButton.addEventListener('mouseout', () => {
            lastfmButton.style.transform = 'scale(1)';
            lastfmImg.style.transform = 'scale(1)';
        });

        lastfmButton.addEventListener('mousedown', () => {
            lastfmButton.style.transform = 'scale(1)';
            lastfmImg.style.transform = 'scale(1)';
        });

        lastfmButton.addEventListener('click', () => {
            buttonClickSound.volume = 0.3;
            buttonClickSound.currentTime = 0;
            buttonClickSound.play();
            window.open('https://www.last.fm/user/carolinekks', '_blank');
        });

        instagramButton.addEventListener('mouseover', () => {
            instagramButton.style.transform = 'scale(1.1)';
            instagramImg.style.transform = 'scale(1.05)';
        });

        instagramButton.addEventListener('mouseout', () => {
            instagramButton.style.transform = 'scale(1)';
            instagramImg.style.transform = 'scale(1)';
        });

        instagramButton.addEventListener('mousedown', () => {
            instagramButton.style.transform = 'scale(1)';
            instagramImg.style.transform = 'scale(1)';
        });

        instagramButton.addEventListener('click', () => {
            buttonClickSound.volume = 0.3;
            buttonClickSound.currentTime = 0;
            buttonClickSound.play();
            window.open('https://www.instagram.com/carolinekks/', '_blank');
        });

        githubButton.addEventListener('mouseover', () => {
            githubButton.style.transform = 'scale(1.1)';
            githubImg.style.transform = 'scale(1.05)';
        });

        githubButton.addEventListener('mouseout', () => {
            githubButton.style.transform = 'scale(1)';
            githubImg.style.transform = 'scale(1)';
        });

        githubButton.addEventListener('mousedown', () => {
            githubButton.style.transform = 'scale(1)';
            githubImg.style.transform = 'scale(1)';
        });

        githubButton.addEventListener('click', () => {
            buttonClickSound.volume = 0.3;
            buttonClickSound.currentTime = 0;
            buttonClickSound.play();
            window.open('https://github.com/carolinekks', '_blank');
        });

        const infoText = document.createElement('div');
        infoText.className = 'sub-text';
        infoText.textContent = '[ all buttons here will open up a new tab ]';
        infoText.style.marginTop = '400px';

        bodyContent.appendChild(steamContainer);
        bodyContent.appendChild(steamContainer2);
        bodyContent.appendChild(telegramContainer);
        bodyContent.appendChild(lastfmContainer);
        bodyContent.appendChild(instagramContainer);
        bodyContent.appendChild(githubContainer);
        bodyContent.appendChild(infoText);

        newBlock.appendChild(closeButton);
        newBlock.appendChild(titleBar);
        newBlock.appendChild(bodyContent);
        document.body.appendChild(newBlock);
        positionWindowRandomly(newBlock, 1000, 600);
        makeDraggable(newBlock);
        socialsBlock = newBlock;
      }

      function handleGalleryClick() {
          buttonClickSound.volume = 0.3;
          buttonClickSound.currentTime = 0;
          buttonClickSound.play();
          if (galleryBlock) return;

          const newBlock = document.createElement('div');
          newBlock.className = 'window gallery';
          newBlock.style.cssText = `
              position: absolute; 
              width: 1000px; 
              height: 600px; 
              visibility: visible; 
              border-radius: 10px; 
              box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15); 
              display: flex; 
              flex-direction: column;
              z-index: 10;
              animation: pop-in 0.5s ease-out forwards;
              transform: scale(0);
              opacity: 0;
          `;

          const closeButton = document.createElement('button');
          closeButton.classList.add("close-button");
          closeButton.textContent = '‚úñ';
          closeButton.style.cssText = `
              position: absolute;
              top: 10px;
              right: 10px;
              background: transparent;
              border: none;
              color: white;
              border-radius: 5px;
              padding: 5px, 10px;
              cursor: pointer;
              font-size: 1.2rem;
              outline: none;
              transition: transform 0.2s ease, background-color 0.3s ease;
              z-index: 15;
          `;

          closeButton.addEventListener('mouseover', () => {
              closeButton.style.transform = 'scale(1.2)';
              closeButton.style.backgroundColor = 'transparent';
          });

          closeButton.addEventListener('mouseout', () => {
              closeButton.style.transform = 'scale(1)';
              closeButton.style.backgroundColor = 'transparent';
          });

          closeButton.addEventListener('mousedown', () => {
              closeButton.style.transform = 'scale(0.8)';
          });

          closeButton.addEventListener('mouseup', () => {
              closeButton.style.transform = 'scale(1)';
          });

          closeButton.addEventListener('click', () => {
              if (newBlock.style.animation.includes('pop-out')) return;
              closeSound.volume = 0.3;
              closeSound.currentTime = 0;
              closeSound.play();
              newBlock.style.animation = 'pop-out 0.5s ease-out forwards';
              setTimeout(() => {
                  newBlock.remove();
                  galleryBlock = null;
              }, 500);
          });

          const titleBar = document.createElement('div');
          titleBar.className = 'window-title';
          titleBar.textContent = 'THE GALLERY!!!';
          titleBar.style.cssText = `
              background-color: rgb(88, 83, 86); 
              color: white; 
              padding: 10px 16px; 
              font-weight: bold; 
              font-size: 1.2rem; 
              cursor: grab; 
              user-select: none;
          `;

          const bodyContent = document.createElement('div');
          bodyContent.className = 'window-body';
          bodyContent.style.cssText = `
              display: flex;
              flex-direction: column;
              align-items: center;
              justify-content: center;
              height: 100%;
              position: relative;
              overflow: hidden;
          `;

          const mainGalleryView = document.createElement('div');
          mainGalleryView.className = 'gallery-main-view';
          mainGalleryView.style.cssText = `
              display: flex;
              flex-direction: column;
              align-items: center;
              justify-content: center;
              width: 100%;
              height: 100%;
              position: absolute;
              top: 0;
              left: 0;
              transition: opacity 0.4s ease, transform 0.4s ease;
          `;

          const galleryTitle = document.createElement('div');
          galleryTitle.className = 'main-text';
          galleryTitle.textContent = 'My Gallery';
          galleryTitle.style.cssText = `
              font-size: 2.5rem;
              margin-bottom: 50px;
          `;

          const foldersContainer = document.createElement('div');
          foldersContainer.style.cssText = `
              display: flex;
              justify-content: center;
              gap: 80px;
              align-items: center;
              flex-wrap: wrap;
          `;

          const folderData = [
              { 
                  name: 'Me IRL', 
                  type: 'irl',
                  description: 'Photos from my recent life'
              },
              { 
                  name: 'Hall of Fame', 
                  type: 'hall-of-fame',
                  description: 'My favorite images that I found really funny'
              },
              { 
                  name: 'Gobi', 
                  type: 'gobi',
                  description: 'My dog :3'
              },
              { 
                  name: 'Me Online', 
                  type: 'digital',
                  description: 'More images about me'
              }
          ];

          folderData.forEach(folder => {
              const folderContainer = document.createElement('div');
              folderContainer.style.cssText = `
                  display: flex;
                  flex-direction: column;
                  align-items: center;
                  gap: 15px;
              `;

              const folderButton = document.createElement('button');
              folderButton.style.cssText = `
                  background: transparent;
                  border: none;
                  cursor: pointer;
                  padding: 0;
                  display: flex;
                  align-items: center;
                  justify-content: center;
                  flex-direction: column;
                  transition: transform 0.2s ease;
                  width: 120px;
                  height: auto;
              `;

              const folderImg = document.createElement('img');
              folderImg.src = '<%= asset_path "folder.svg" %>';
              folderImg.classList.add('folder-img', 'theme-icon');
              folderImg.style.cssText = `
                  width: 100px;
                  height: 100px;
                  transition: transform 0.3s ease;
              `;

              const folderText = document.createElement('div');
              folderText.textContent = folder.name;
              folderText.className = 'button-text folder-text theme-text';
              folderText.style.cssText = `
                  color: ${document.body.classList.contains('dark-mode') ? 'white' : 'black'};
                  font-size: 1.2rem;
                  transition: color 0.3s ease;
                  margin-top: 10px;
              `;

              folderButton.addEventListener('mouseover', () => {
                  folderButton.style.transform = 'scale(1.1)';
                  folderImg.style.transform = 'scale(1.05)';
              });

              folderButton.addEventListener('mouseout', () => {
                  folderButton.style.transform = 'scale(1)';
                  folderImg.style.transform = 'scale(1)';
              });

              folderButton.addEventListener('mousedown', () => {
                  folderButton.style.transform = 'scale(0.95)';
              });

              folderButton.addEventListener('mouseup', () => {
                  folderButton.style.transform = 'scale(1.1)';
              });

              let folderClickInProgress = false;
              folderButton.addEventListener('click', () => {
                  if (folderClickInProgress || (galleryBlock && galleryBlock.querySelector('.folder-content-view'))) {
                      return;
                  }
                  folderClickInProgress = true;
                  
                  folderSound.volume = 0.3;
                  folderSound.currentTime = 0;
                  folderSound.play();
                  showFolderContent(folder.type, folder.name, folder.description, mainGalleryView, bodyContent);

                  setTimeout(() => {
                      folderClickInProgress = false;
                  }, 500);
              });

              folderButton.appendChild(folderImg);
              folderContainer.appendChild(folderButton);
              folderContainer.appendChild(folderText);
              foldersContainer.appendChild(folderContainer);
          });

          mainGalleryView.appendChild(galleryTitle);
          mainGalleryView.appendChild(foldersContainer);
          bodyContent.appendChild(mainGalleryView);

          newBlock.appendChild(closeButton);
          newBlock.appendChild(titleBar);
          newBlock.appendChild(bodyContent);
          document.body.appendChild(newBlock);
          positionWindowRandomly(newBlock, 1000, 600);
          makeDraggable(newBlock);
          
          galleryBlock = newBlock;

          function showFolderContent(folderType, folderName, folderDescription, mainView, bodyContent) {
              mainView.style.opacity = '0';
              mainView.style.transform = 'translateY(20px)';

              setTimeout(() => {
                  mainView.style.display = 'none';

                  const folderView = document.createElement('div');
                  folderView.className = 'folder-content-view';
                  folderView.style.cssText = `
                      display: flex;
                      flex-direction: column;
                      align-items: center;
                      width: 100%;
                      height: 100%;
                      position: absolute;
                      top: 0;
                      left: 0;
                      padding: 15px;
                      opacity: 0;
                      transform: translateY(20px);
                      transition: opacity 0.4s ease, transform 0.4s ease;
                      justify-content: flex-start;
                  `;

                  const backButton = document.createElement('button');
                  backButton.classList.add('back-button', 'theme-text');
                  backButton.style.cssText = `
                      align-self: flex-start;
                      background: transparent;
                      border: none;
                      cursor: pointer;
                      padding: 10px 20px;
                      margin-bottom: 20px;
                      display: flex;
                      align-items: center;
                      gap: 10px;
                      transition: transform 0.2s ease;
                      color: ${document.body.classList.contains('dark-mode') ? 'white' : 'black'};
                      font-size: 1.1rem;
                      border-radius: 5px;
                  `;

                  const backArrow = document.createElement('span');
                  backArrow.textContent = '‚Üê';
                  backArrow.style.cssText = `
                      font-size: 1.3rem;
                  `;

                  const backText = document.createElement('span');
                  backText.textContent = 'Back to Gallery';

                  backButton.appendChild(backArrow);
                  backButton.appendChild(backText);

                  let backClickInProgress = false;
                  backButton.addEventListener('click', () => {
                      if (backClickInProgress || folderView.style.opacity === '0') return;
                      backClickInProgress = true;
                      
                      folderSound.volume = 0.3;
                      folderSound.currentTime = 0;
                      folderSound.play();

                      folderView.style.opacity = '0';
                      folderView.style.transform = 'translateY(20px)';
                      
                      setTimeout(() => {
                          folderView.remove();
                          mainView.style.display = 'flex';
                          setTimeout(() => {
                              mainView.style.opacity = '1';
                              mainView.style.transform = 'translateY(0)';
                              backClickInProgress = false;
                          }, 50);
                      }, 400);
                  });

                  backButton.addEventListener('mouseover', () => {
                      if (!backClickInProgress) {
                          backButton.style.transform = 'scale(1.05)';
                          backButton.style.backgroundColor = document.body.classList.contains('dark-mode') ? 'rgba(255,255,255,0.1)' : 'rgba(0,0,0,0.05)';
                      }
                  });

                  backButton.addEventListener('mouseout', () => {
                      backButton.style.transform = 'scale(1)';
                      backButton.style.backgroundColor = 'transparent';
                  });

                  const folderTitle = document.createElement('div');
                  folderTitle.className = 'main-text';
                  folderTitle.textContent = folderDescription;
                  folderTitle.style.cssText = `
                      font-size: 2rem;
                      margin-bottom: 10px;
                      text-align: center;
                      line-height: 1.4;
                  `;

                  const folderSubtitle = document.createElement('div');
                  folderSubtitle.className = 'sub-text';
                  folderSubtitle.textContent = folderName;
                  folderSubtitle.style.cssText = `
                      font-size: 1.3rem;
                      opacity: 0.7;
                      margin-bottom: 20px;
                      font-style: italic;
                  `;
                  const imageGrid = document.createElement('div');
                  imageGrid.className = 'image-grid'

                  /* NEW IMAGES GO HERE AT THE TOP OF THE LIST */
                  /* DATE FORMAT D/M/Y */
                  const imageData = {
                      'irl': [
                          { src: '<%= asset_path "irl/photo6.webp" %>', caption: 'Fallbrook, CA', alt: '19/12/25' },
                          { src: '<%= asset_path "irl/photo5.webp" %>', caption: 'Huntington Beach, CA', alt: '28/08/25' },
                          { src: '<%= asset_path "irl/photo4.webp" %>', caption: 'Austin, TX', alt: '14/03/25' },
                          { src: '<%= asset_path "irl/photo3.webp" %>', caption: 'San Francisco, CA', alt: '23/01/25' },
                          { src: '<%= asset_path "irl/photo2.webp" %>', caption: 'NYC pride parade', alt: '30/06/24' },
                          { src: '<%= asset_path "irl/photo1.webp" %>', caption: 'Boston, MA', alt: '06/04/24' }
                      ],
                      'hall-of-fame': [
                          { src: '<%= asset_path "hof/photo7.webp" %>', caption: 'They fucked bjork shit up', alt: 'üò≠üò≠üò≠üò≠' },
                          { src: '<%= asset_path "hof/photo6.webp" %>', caption: 'My homeboy got pregnant from all the dickriding & now he finally having the baby üíö', alt: '' },
                          { src: '<%= asset_path "hof/photo5.webp" %>', caption: 'Inshallah', alt: 'he will fix it' },
                          { src: '<%= asset_path "hof/photo4.webp" %>', caption: 'Chiikawa', alt: 'what happened üíî' },
                          { src: '<%= asset_path "hof/photo3.webp" %>', caption: '2 weeks after prozac', alt: 'hell' },
                          { src: '<%= asset_path "hof/photo2.webp" %>', caption: 'No comment', alt: '...' },
                          { src: '<%= asset_path "hof/photo1.webp" %>', caption: 'Fluttershy cake', alt: '' }
                      ],
                      'gobi': [
                          { src: '<%= asset_path "gobi/photo7.webp" %>', caption: 'He got that shit on though', alt: '28/12/25' },
                          { src: '<%= asset_path "gobi/photo6.webp" %>', caption: 'Jul 2025', alt: '24/12/25' },
                          { src: '<%= asset_path "gobi/photo5.webp" %>', caption: 'He does NOT fw my pumpkin :(', alt: '10/26/25' },
                          { src: '<%= asset_path "gobi/photo4.webp" %>', caption: 'On the way to the beach', alt: '08/28/25' },
                          { src: '<%= asset_path "gobi/photo3.webp" %>', caption: 'So cozy', alt: '04/29/25' },
                          { src: '<%= asset_path "gobi/photo2.webp" %>', caption: 'The eeper', alt: '04/12/25' },
                          { src: '<%= asset_path "gobi/photo1.webp" %>', caption: 'The yapper', alt: '21/02/25' }
                      ],
                      'digital': [
                        { src: '<%= asset_path "digital/photo2.webp" %>', caption: 'My top 25 favorite games :3', alt: '(as of Feb 2026 at least)' },
                        { src: '<%= asset_path "digital/photo1.webp" %>', caption: 'My most Listened albums 2025', alt: 'LEXYCAT SWEEP RAHHHHH' }
                      ]
                  };

                  const currentImages = imageData[folderType] || [];

                  currentImages.forEach((image, index) => {
                      const imageContainer = document.createElement('div');

                      const img = document.createElement('img');
                      img.setAttribute('loading', 'lazy');
                      img.setAttribute('decoding', 'async');
                      img.src = image.src;
                      img.alt = image.alt;
                      img.setAttribute('draggable', 'false');

                      imageContainer.addEventListener('mouseover', () => {
                          imageContainer.style.transform = 'scale(1.05)';
                          img.style.transform = 'scale(1.1)';
                      });

                      imageContainer.addEventListener('mouseout', () => {
                          imageContainer.style.transform = 'scale(1)';
                          img.style.transform = 'scale(1)';
                      });

                      imageContainer.addEventListener('mousedown', () => {
                          imageContainer.style.transform = 'scale(0.95)';
                      });

                      imageContainer.addEventListener('mouseup', () => {
                          imageContainer.style.transform = 'scale(1.05)';
                      });

                      let imageClickInProgress = false;
                      imageContainer.addEventListener('click', () => {
                          if (imageClickInProgress || folderView.querySelector('.enlarged-view')) {
                              return;
                          }
                          imageClickInProgress = true;
                          
                          folderSound.volume = 0.3;
                          folderSound.currentTime = 0;
                          folderSound.play();
                          showEnlargedImage(image, folderView, imageGrid);
                          
                          setTimeout(() => {
                              imageClickInProgress = false;
                          }, 500);
                      });

                      imageContainer.appendChild(img);
                      imageGrid.appendChild(imageContainer);
                  });

                  if (currentImages.length === 0) {
                      const placeholder = document.createElement('div');
                      placeholder.style.cssText = `
                          grid-column: 1 / -1;
                          text-align: center;
                          color: ${document.body.classList.contains('dark-mode') ? 'white' : 'black'};
                          font-size: 1.3rem;
                          opacity: 0.7;
                          padding: 40px;
                      `;
                      placeholder.textContent = 'No images in this folder yet!';
                      imageGrid.appendChild(placeholder);
                  }

                  folderView.appendChild(backButton);
                  folderView.appendChild(folderTitle);
                  folderView.appendChild(folderSubtitle);
                  folderView.appendChild(imageGrid);
                  bodyContent.appendChild(folderView);

                  setTimeout(() => {
                      folderView.style.opacity = '1';
                      folderView.style.transform = 'translateY(0)';
                  }, 50);

                  function showEnlargedImage(image, folderView, imageGrid) {
                      if (folderView.querySelector('.enlarged-view')) {
                          return;
                      }

                      const folderTitle = folderView.querySelector('.main-text');
                      const folderSubtitle = folderView.querySelector('.sub-text');
                      const backButton = folderView.querySelector('button');
                      
                      const enlargedView = document.createElement('div');
                      enlargedView.className = 'enlarged-view';
                      enlargedView.style.cssText = `
                          position: absolute;
                          top: 0;
                          left: 0;
                          width: 100%;
                          height: 100%;
                          display: flex;
                          align-items: center;
                          justify-content: space-between;
                          padding: 40px;
                          opacity: 0;
                          transform: scale(0.95);
                          transition: opacity 0.3s ease, transform 0.3s ease;
                          box-sizing: border-box;
                          z-index: 20;
                          background: inherit;
                      `;

                      const backToFolderButton = document.createElement('button');
                      backToFolderButton.style.cssText = `
                          position: absolute;
                          top: 20px;
                          left: 20px;
                          background: transparent;
                          border: none;
                          cursor: pointer;
                          padding: 10px 20px;
                          display: flex;
                          align-items: center;
                          gap: 10px;
                          transition: transform 0.2s ease;
                          color: ${document.body.classList.contains('dark-mode') ? 'white' : 'black'};
                          font-size: 1.1rem;
                          border-radius: 5px;
                          z-index: 21;
                      `;

                      const backToFolderArrow = document.createElement('span');
                      backToFolderArrow.textContent = '‚Üê';
                      backToFolderArrow.style.cssText = `font-size: 1.3rem;`;

                      const backToFolderText = document.createElement('span');
                      backToFolderText.textContent = 'Back to Folder';

                      backToFolderButton.appendChild(backToFolderArrow);
                      backToFolderButton.appendChild(backToFolderText);

                      let backToFolderClickInProgress = false;
                      backToFolderButton.addEventListener('click', () => {
                          if (backToFolderClickInProgress) return;
                          backToFolderClickInProgress = true;
                          
                          folderSound.volume = 0.3;
                          folderSound.currentTime = 0;
                          folderSound.play();

                          enlargedView.style.opacity = '0';
                          enlargedView.style.transform = 'scale(0.95)';
                          
                          setTimeout(() => {
                              enlargedView.remove();
                              
                              folderTitle.style.display = 'block';
                              folderSubtitle.style.display = 'block';
                              backButton.style.display = 'block';
                              imageGrid.style.display = 'grid';
                              
                              setTimeout(() => {
                                  folderTitle.style.opacity = '1';
                                  folderSubtitle.style.opacity = '1';
                                  backButton.style.opacity = '1';
                                  imageGrid.style.opacity = '1';
                                  imageGrid.style.transform = 'scale(1)';
                                  backToFolderClickInProgress = false;
                              }, 50);
                          }, 300);
                      });

                      backToFolderButton.addEventListener('mouseover', () => {
                          if (!backToFolderClickInProgress) {
                              backToFolderButton.style.transform = 'scale(1.05)';
                              backToFolderButton.style.backgroundColor = document.body.classList.contains('dark-mode') ? 'rgba(255,255,255,0.1)' : 'rgba(0,0,0,0.05)';
                          }
                      });

                      backToFolderButton.addEventListener('mouseout', () => {
                          backToFolderButton.style.transform = 'scale(1)';
                          backToFolderButton.style.backgroundColor = 'transparent';
                      });

                      const imageContainer = document.createElement('div');
                      imageContainer.style.cssText = `
                          flex: 0 0 65%;
                          display: flex;
                          flex-direction: column;
                          align-items: center;
                          justify-content: center;
                          height: 100%;
                          padding: 20px;
                          box-sizing: border-box;
                      `;

                      const enlargedImg = document.createElement('img');
                      enlargedImg.src = image.src;
                      enlargedImg.alt = image.alt;
                      enlargedImg.style.cssText = `
                          max-width: 85%; 
                          max-height: 75%;
                          object-fit: contain;
                          border-radius: 10px;
                          box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
                          display: block;
                      `;
                      enlargedImg.style.background = 'var(--aboutme-content-bg)';
                      enlargedImg.onload = function() {
                          this.style.background = 'transparent';
                      };
                      enlargedImg.setAttribute('draggable', 'false');
                      enlargedImg.addEventListener('dragstart', (e) => e.preventDefault());

                      const infoContainer = document.createElement('div');
                      infoContainer.style.cssText = `
                          flex: 0 0 35%;
                          display: flex;
                          flex-direction: column;
                          justify-content: center;
                          height: 100%;
                          padding: 40px 20px;
                          box-sizing: border-box;
                      `;
                      
                      const captionTitle = document.createElement('div');
                      captionTitle.textContent = image.caption;
                      captionTitle.classList.add('changelog-title', 'theme-text');
                      captionTitle.style.cssText = `
                          font-size: 2.2rem;
                          font-weight: bold;
                          font-style: italic;
                          margin-bottom: 10px;
                          opacity: 0.9;
                          line-height: 1.2;
                          text-align: left;
                          width: 100%;
                      `;

                      const caption = document.createElement('div');
                      caption.textContent = image.alt;
                      caption.classList.add('changelog-content', 'theme-text');
                      caption.style.cssText = `
                          font-size: 1.3rem;
                          line-height: 1.4;
                          max-height: 150px;
                          overflow-y: auto;
                          padding-right: 10px;
                          margin-top: 5px;
                          text-align: left;
                          width: 100%;
                      `;

                      imageContainer.appendChild(enlargedImg);
                      infoContainer.appendChild(captionTitle);
                      infoContainer.appendChild(caption);

                      enlargedView.appendChild(backToFolderButton);
                      enlargedView.appendChild(imageContainer);
                      enlargedView.appendChild(infoContainer);
                      folderView.appendChild(enlargedView);

                      folderTitle.style.opacity = '0';
                      folderSubtitle.style.opacity = '0';
                      backButton.style.opacity = '0';
                      imageGrid.style.opacity = '0';
                      imageGrid.style.transform = 'scale(0.9)';

                      setTimeout(() => {
                          enlargedView.style.opacity = '1';
                          enlargedView.style.transform = 'scale(1)';
                          
                          setTimeout(() => {
                              folderTitle.style.display = 'none';
                              folderSubtitle.style.display = 'none';
                              backButton.style.display = 'none';
                              imageGrid.style.display = 'none';
                          }, 300);
                      }, 150);
                  }
              }, 400);
          }

          const darkModeObserver = new MutationObserver(() => {
              const isDarkMode = document.body.classList.contains('dark-mode');

              const folderImages = newBlock.querySelectorAll('.gallery-main-view img[src*="folder.svg"]');
              folderImages.forEach(img => {
                  img.style.filter = isDarkMode ? 'invert(1) hue-rotate(180deg)' : 'invert(0) hue-rotate(0deg)';
              });

              const folderTexts = newBlock.querySelectorAll('.button-text');
              folderTexts.forEach(text => {
                  text.style.color = isDarkMode ? 'white' : 'black';
              });

              const allTextElements = newBlock.querySelectorAll('.main-text, .sub-text, .image-caption, .window-body > div:not(.image-grid)');
              allTextElements.forEach(text => {
                  text.style.color = isDarkMode ? 'white' : 'black';
              });

              const allButtons = newBlock.querySelectorAll('button');
              allButtons.forEach(button => {
                  button.style.color = isDarkMode ? 'white' : 'black';
              });

              const captionTitles = newBlock.querySelectorAll('.enlarged-view .caption-title');
              captionTitles.forEach(title => {
                  title.style.color = isDarkMode ? 'white' : 'black';
              });

              const captionStyle = newBlock.querySelector('.caption-scrollbar-style');
              if (captionStyle) {
                  captionStyle.textContent = `
                      .image-caption::-webkit-scrollbar {
                          width: 6px;
                      }
                      .image-caption::-webkit-scrollbar-track {
                          background: ${isDarkMode ? 'rgba(255,255,255,0.1)' : 'rgba(0,0,0,0.1)'};
                          border-radius: 3px;
                      }
                      .image-caption::-webkit-scrollbar-thumb {
                          background: ${isDarkMode ? '#ffa1b8' : '#ff4c6d'};
                          border-radius: 3px;
                      }
                  `;
              }
          });

          darkModeObserver.observe(document.body, {
              attributes: true,
              attributeFilter: ['class']
          });

          newBlock._observers = [darkModeObserver];
      }

        async function handleChangelogClick() {
          buttonClickSound.volume = 0.3;
          buttonClickSound.currentTime = 0;
          buttonClickSound.play();
          if (changelogBlock) return;

          const newBlock = document.createElement('div');
          newBlock.className = 'window changelog';
          newBlock.style.cssText = `
            position: absolute; 
            width: 1000px; 
            height: 600px; 
            visibility: visible; 
            border-radius: 10px; 
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15); 
            display: flex; 
            flex-direction: column;
            z-index: 10;
            animation: pop-in 0.5s ease-out forwards;
            transform: scale(0);
            opacity: 0;
          `;

          const closeButton = document.createElement('button');
          closeButton.textContent = '‚úñ';
          closeButton.style.cssText = `
              position: absolute;
              top: 10px;
              right: 10px;
              background: transparent;
              border: none;
              color: white;
              border-radius: 5px;
              padding: 5px, 10px;
              cursor: pointer;
              font-size: 1.2rem;
              outline: none;
              transition: transform 0.2s ease, background-color 0.3s ease;
          `;

          closeButton.addEventListener('mouseover', () => {
              closeButton.style.transform = 'scale(1.2)';
              closeButton.style.backgroundColor = 'transparent';
          });

          closeButton.addEventListener('mouseout', () => {
              closeButton.style.transform = 'scale(1)';
              closeButton.style.backgroundColor = 'transparent';
          });

          closeButton.addEventListener('mousedown', () => {
              closeButton.style.transform = 'scale(0.8)';
          });

          closeButton.addEventListener('mouseup', () => {
              closeButton.style.transform = 'scale(1)';
          });

          const titleBar = document.createElement('div');
          titleBar.className = 'window-title';
          titleBar.textContent = 'Changelog~';
          titleBar.style.cssText = `
              background-color: rgb(88, 83, 86); 
              color: white; 
              padding: 10px 16px; 
              font-weight: bold; 
              font-size: 1.2rem; 
              cursor: grab; 
              user-select: none;
          `;

          const bodyContent = document.createElement('div');
          bodyContent.className = 'window-body';
          bodyContent.style.cssText = `
              display: flex;
              flex-direction: column;
              align-items: flex-start;
              padding: 20px;
              overflow-y: auto;
              text-align: left;
              max-height: 500px;
          `;

          const loadingMessage = document.createElement('div');
          loadingMessage.textContent = 'Loading changelog from GitHub...';
          loadingMessage.classList.add('theme-text');
          loadingMessage.style.cssText = `
              text-align: center;
              width: 100%;
              padding: 20px;
          `;
          bodyContent.appendChild(loadingMessage);

          const changelogId = `changelog-${Date.now()}`;
          newBlock.id = changelogId;

          const style = document.createElement('style');
          style.textContent = generateChangelogStyles(changelogId, document.body.classList.contains('dark-mode'));
          newBlock.appendChild(style);

          newBlock.appendChild(closeButton);
          newBlock.appendChild(titleBar);
          newBlock.appendChild(bodyContent);
          document.body.appendChild(newBlock);
          positionWindowRandomly(newBlock, 1000, 600);
          makeDraggable(newBlock);
          changelogBlock = newBlock;

          try {
              const commits = await fetchGitHubCommits();
              bodyContent.removeChild(loadingMessage);
              renderChangelogItems(bodyContent, commits, changelogId);
          } catch (error) {
              console.error('Error fetching GitHub commits:', error);
              
              loadingMessage.textContent = 'GitHub API limit reached. Showing static changelog data.';
              loadingMessage.style.color = document.body.classList.contains('dark-mode') ? '#ff7f91' : '#ff4c6d';
              
              setTimeout(() => {
                  bodyContent.removeChild(loadingMessage);
                  renderStaticChangelog(bodyContent, changelogId);
              }, 2000);
          }

          const darkModeObserver = new MutationObserver(() => {
              style.textContent = generateChangelogStyles(changelogId, document.body.classList.contains('dark-mode'));
          });
          darkModeObserver.observe(document.body, {
              attributes: true,
              attributeFilter: ['class']
          });

          closeButton.addEventListener('click', () => {
              darkModeObserver.disconnect();
              closeSound.volume = 0.3;
              closeSound.currentTime = 0;
              closeSound.play();
              newBlock.style.animation = 'pop-out 0.5s ease-out forwards';
              setTimeout(() => {
                  newBlock.remove();
                  changelogBlock = null;
              }, 500);
              newBlock.querySelectorAll('*').forEach(el => {
                el.replaceWith(el.cloneNode(true));
              });
          });
      }

      async function fetchGitHubCommits() {
          try {
              // ('Fetching from /changelog_data...');
              const response = await fetch('/changelog_data');
              
              // console.log('Response status:', response.status);
              
              if (!response.ok) {
                  throw new Error(`Server error: ${response.status}`);
              }
              
              const commits = await response.json();
              // console.log('Received commits:', commits);
              
              const processedCommits = commits.map(commit => {
                  const sanitizeText = (text) => {
                      return text ? text.replace(/[<>]/g, '') : '';
                  };
                  
                  return {
                      date: commit.date,
                      title: sanitizeText(commit.title || ''),
                      details: (commit.details || []).map(line => sanitizeText(line)),
                      sha: commit.sha || 'unknown',
                      url: commit.url || '#',
                      stats: commit.stats || { additions: 0, deletions: 0, total: 0 }
                  };
              });
              
              // console.log('Processed commits:', processedCommits);
              return processedCommits;
              
          } catch (error) {
              console.error('Error fetching changelog from server:', error);
              throw new Error('Failed to load changelog data');
          }
      }

      function renderChangelogItems(container, commits, changelogId) {
          commits.forEach(commit => {
              const itemElement = createChangelogItem(commit, changelogId);
              container.appendChild(itemElement);
          });
      }

      function createChangelogItem(commit, changelogId) {
          const itemElement = document.createElement('div');
          itemElement.className = 'changelog-item';
          
          const header = document.createElement('div');
          header.className = 'changelog-header';

          const dateSpan = document.createElement('span');
          dateSpan.className = 'changelog-date';
          dateSpan.textContent = commit.date;

          const titleSpan = document.createElement('span');
          titleSpan.classList.add('changelog-title', 'theme-text');
          titleSpan.textContent = commit.title;

          const changesSpan = document.createElement('span');
          changesSpan.className = 'changelog-changes';
          
          if (commit.stats && (commit.stats.additions > 0 || commit.stats.deletions > 0)) {
              changesSpan.innerHTML = `
                  <span class="changes-additions">+${commit.stats.additions}</span>
                  <span class="changes-deletions">-${commit.stats.deletions}</span>
                  <span class="changes-total">${commit.stats.total} lines</span>
              `;
          } else {
              changesSpan.innerHTML = '<span class="changes-total">No changes</span>';
          }

          let shaSpan = null;
          if (commit.sha) {
              shaSpan = document.createElement('span');
              shaSpan.className = 'changelog-sha';
              shaSpan.textContent = commit.sha;
          }

          header.appendChild(dateSpan);
          header.appendChild(titleSpan);
          header.appendChild(changesSpan);
          if (shaSpan) {
              header.appendChild(shaSpan);
          }
          
          const content = document.createElement('div');
          content.classList.add('changelog-content', 'theme-text');
          
          const detailsList = document.createElement('ul');
          detailsList.className = 'changelog-details';
          
          if (commit.details && commit.details.length > 0) {
              commit.details.forEach(detail => {
                  if (detail.trim()) {
                      const li = document.createElement('li');
                      li.textContent = detail.trim();
                      detailsList.appendChild(li);
                  }
              });
          } else {
              const li = document.createElement('li');
              li.textContent = 'No additional details';
              li.style.opacity = '0.6';
              detailsList.appendChild(li);
          }
          
          if (commit.url) {
              const linkItem = document.createElement('li');
              const link = document.createElement('a');
              link.href = commit.url;
              link.target = '_blank';
              link.rel = 'noopener noreferrer';
              link.textContent = 'View on GitHub ‚Üí';
              linkItem.appendChild(link);
              detailsList.appendChild(linkItem);
          }
          
          content.appendChild(detailsList);
          
          header.addEventListener('click', () => {
              buttonClickSound.volume = 0.2;
              buttonClickSound.currentTime = 0;
              buttonClickSound.play();

              document.querySelectorAll(`#${changelogId} .changelog-content.open`).forEach(openContent => {
                  if (openContent !== content) {
                      openContent.classList.remove('open');
                      openContent.previousElementSibling.classList.remove('open');
                  }
              });
                  
              header.classList.toggle('open');
              content.classList.toggle('open');
          });
          
          itemElement.appendChild(header);
          itemElement.appendChild(content);
          
          return itemElement;
      }

      function generateChangelogStyles(changelogId, isDarkMode) {
          return `
              #${changelogId} .changelog-item {
                  width: 95%;
                  margin: 20px auto;
                  border-radius: 8px;
                  overflow: hidden;
                  transition: all 0.3s ease;
                  border: 1px solid ${isDarkMode ? 'rgba(255,255,255,0.1)' : 'rgba(0,0,0,0.1)'};
              }

              #${changelogId} .window-body {
                  scrollbar-width: thick;
                  scrollbar-color: ${isDarkMode ? '#ffa1b8' : '#ff4c6d'} ${isDarkMode ? 'rgba(255,255,255,0.05)' : 'rgba(0,0,0,0.05)'};
                  overflow: auto !important;
                  display: block !important;
                  overflow-y: auto !important;
                  height: 500px !important;
                  max-height: 500px !important;
                  padding: 25px !important;
                  text-align: left !important;
                  scrollbar-gutter: stable;
              }

              #${changelogId} .window-body::-webkit-scrollbar {
                  width: 20px !important;
                  height: 20px !important;
              }

              #${changelogId} .window-body::-webkit-scrollbar-track {
                  background: ${isDarkMode ? 'rgba(255,255,255,0.08)' : 'rgba(0,0,0,0.08)'} !important;
                  border-radius: 10px !important;
                  margin: 8px !important;
                  border: 3px solid transparent !important;
                  background-clip: content-box !important;
              }

              #${changelogId} .window-body::-webkit-scrollbar-thumb {
                  background: ${isDarkMode ? '#ffa1b8' : '#ff4c6d'} !important;
                  border-radius: 10px !important;
                  border: 4px solid transparent !important;
                  background-clip: content-box !important;
              }

              #${changelogId} .window-body::-webkit-scrollbar-thumb:hover {
                  background: ${isDarkMode ? '#ff7f91' : '#ff4c6d'} !important;
              }

              #${changelogId} .window-body::-webkit-scrollbar-corner {
                  background: transparent !important;
              }

              #${changelogId} .changelog-item + .changelog-item {
                  margin-top: 20px;
              }

              #${changelogId} .changelog-date,
              #${changelogId} .changelog-title,
              #${changelogId} .changelog-sha {
                  display: inline;
                  margin: 0;
                  line-height: 1.4;
              }

              #${changelogId} .changelog-content.open {
                  max-height: none;
              }

              #${changelogId} .changelog-header {
                  display: flex;
                  align-items: center;
                  justify-content: space-between;
                  gap: 15px;
                  padding: 15px 20px;
                  background-color: ${isDarkMode ? 'rgba(255,255,255,0.08)' : 'rgba(0,0,0,0.04)'};
                  cursor: pointer;
                  user-select: none;
                  transition: all 0.3s ease;
                  width: 100%;
                  box-sizing: border-box;
                  flex-wrap: wrap;
              }
              
              #${changelogId} .changelog-header:hover {
                  background-color: ${isDarkMode ? 'rgba(255,255,255,0.12)' : 'rgba(0,0,0,0.06)'};
              }
              
              #${changelogId} .changelog-header::before {
                  content: '‚ñ∂';
                  display: inline-block;
                  margin-right: 12px;
                  font-size: 0.9em;
                  transition: transform 0.3s ease;
                  color: ${isDarkMode ? '#ffa1b8' : '#ff4c6d'};
                  vertical-align: middle;
              }
              
              #${changelogId} .changelog-header.open::before {
                  transform: rotate(90deg);
              }
              
              #${changelogId} .changelog-content {
                  max-height: 0;
                  overflow: hidden;
                  padding: 0 20px;
                  background-color: ${isDarkMode ? 'rgba(255,255,255,0.03)' : 'rgba(0,0,0,0.02)'};
                  transition: all 0.3s ease;
                  box-sizing: border-box;
                  width: 100%;
              }
              
              #${changelogId} .changelog-content.open {
                  max-height: 500px;
                  padding: 25px;
                  overflow-y: auto;
              }
              
              #${changelogId} .changelog-date {
                  font-weight: 600;
                  color: ${isDarkMode ? '#ffa1b8' : '#ff4c6d'};
                  min-width: 120px;
              }
              
              #${changelogId} .changelog-title {
                  flex-grow: 1;
                  text-align: left;
                  font-weight: 600;
                  font-size: 0.9rem;
                  color: inherit;
              }

              #${changelogId} .changelog-sha {
                  font-family: monospace;
                  background: ${isDarkMode ? 'rgba(255,255,255,0.1)' : 'rgba(0,0,0,0.05)'};
                  padding: 4px 8px;
                  border-radius: 4px;
                  font-size: 0.9rem;
              }
              
              #${changelogId} .changelog-details {
                  margin-top: 15px;
                  padding-left: 0;
                  list-style-type: none;
                  width: 100%;
              }
              
              #${changelogId} .changelog-details li {
                  margin-bottom: 12px;
                  position: relative;
                  padding-left: 24px;
                  text-align: left;
                  word-wrap: break-word;
                  font-size: 1.1rem;
                  line-height: 1.6;
              }
              
              #${changelogId} .changelog-details li::before {
                  content: '‚Ä¢';
                  position: absolute;
                  left: 8px;
                  color: ${isDarkMode ? '#ffa1b8' : '#ff4c6d'};
                  font-size: 1.4em;
                  font-weight: bold;
              }

              #${changelogId} a {
                  color: ${isDarkMode ? '#ffa1b8' : '#ff4c6d'} !important;
                  text-decoration: none;
                  font-weight: bold;
                  padding: 4px 8px;
                  border-radius: 3px;
                  background: ${isDarkMode ? 'rgba(255,255,255,0.1)' : 'rgba(0,0,0,0.05)'};
                  display: inline-block;
                  margin-top: 5px;
              }

              #${changelogId} a:hover {
                  text-decoration: underline;
                  background: ${isDarkMode ? 'rgba(255,255,255,0.15)' : 'rgba(0,0,0,0.08)'};
              }
              
              #${changelogId} .changelog-changes {
                  display: flex;
                  gap: 8px;
                  align-items: center;
                  font-family: monospace;
                  font-size: 0.8rem;
              }
              
              #${changelogId} .changes-additions {
                  color: #3fb950;
                  font-weight: bold;
              }
              
              #${changelogId} .changes-deletions {
                  color: #f85149;
                  font-weight: bold;
              }
              
              #${changelogId} .changes-total {
                  color: ${isDarkMode ? '#8b949e' : '#656d76'};
                  margin-left: 4px;
              }
          `;
      }

      function renderStaticChangelog(container, changelogId) {
          const staticData = [
              {
                  date: "2025-01-15",
                  title: "Static Changelog Data",
                  details: ["GitHub API is currently unavailable.", "Showing static changelog data instead."],
                  sha: "static",
                  url: "https://github.com/carolinekks/carolinekks.dk",
                  stats: { additions: 0, deletions: 0, total: 0 }
              },
              {
                  date: "2025-05-19",
                  title: "Preproduction push", 
                  details: ["First push to github"],
                  sha: "static",
                  url: "https://github.com/carolinekks/carolinekks.dk",
                  stats: { additions: 0, deletions: 0, total: 0 }
              }
          ];
          
          staticData.forEach(item => {
              const itemElement = createChangelogItem(item, changelogId);
              container.appendChild(itemElement);
          });
      }

      aboutmeBtn.addEventListener('click', handleAboutMeClick); 
      socialsBtn.addEventListener('click', handleSocialsClick);
      galleryBtn.addEventListener('click', handleGalleryClick);
      changelogBtn.addEventListener('click', handleChangelogClick);

      const NUM_SPARKLES = 100;
      const container = document.getElementById('sparkle-container');

      function createSparkle() {
        const sparkle = document.createElement('div');
        sparkle.classList.add('sparkle');

        const size = Math.random() * 3 + 2;
        sparkle.style.width = `${size}px`;
        sparkle.style.height = `${size}px`;

        sparkle.style.left = `${Math.random() * 100}%`;
        sparkle.style.top = `${Math.random() * 100}%`;

        sparkle.style.animationDelay = `${Math.random() * 4}s`;

        container.appendChild(sparkle);
      }

      for (let i = 0; i < NUM_SPARKLES; i++) {
        createSparkle();
      }
    });
  </script>
</body>
</html>